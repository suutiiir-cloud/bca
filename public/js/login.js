var my_xmlhttp=null,buf_request_in_progress=!1,token_push_request_in_progress=!1,famreqid="",pol_id="",grp="",pass_renew="",peer="",elm_ftm_push_enabled=document.getElementById("ftm_push_enabled"),ftm_pushed_enabled=elm_ftm_push_enabled&&elm_ftm_push_enabled.value;function get_xmlhttp(){var e=null;try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){e=null}}return e||"undefined"==typeof XMLHttpRequest||(e=new XMLHttpRequest),e}function handle_buffer_ready(){if(buf_request_in_progress){buf_request_in_progress=!1,token_push_request_in_progress=!1;var e=my_xmlhttp.responseText;if(my_xmlhttp=null,0!=e.length){for(var t=e.split(","),n=0,d="",o="",l="",r="",i="",s="",m=0,a=0;a<t.length;a++)0==t[a].indexOf("ret=")?n=parseInt(t[a].substring(4)):0==t[a].indexOf("redir=")?d=t[a].substring(6):0==t[a].indexOf("err=")?t[a].substring(4):0==t[a].indexOf("reqid=")?famreqid=t[a].substring(6):0==t[a].indexOf("polid=")?pol_id=t[a].substring(6):0==t[a].indexOf("grp=")?grp=t[a].substring(4):0==t[a].indexOf("tokeninfo=")?tokeninfo=t[a].substring(10):0==t[a].indexOf("actionurl=")?t[a].substring(10):0==t[a].indexOf("magic=")?o=t[a].substring(6):0==t[a].indexOf("grpid=")?l=t[a].substring(6):0==t[a].indexOf("pid=")?r=t[a].substring(4):0==t[a].indexOf("is_chal_rsp=")?s=t[a].substring(12):0==t[a].indexOf("pass_renew=")?pass_renew=t[a].substring(11):0==t[a].indexOf("allow_cancel=")?m=parseInt(t[a].substring(13)):0==t[a].indexOf("chal_msg=")?(index=e.indexOf("chal_msg="),index&&(i=e.substring(index+9))):0==t[a].indexOf("peer=")&&(peer=t[a].substring(5));try{document.getElementById("token_msg").style.display="none"}catch(e){}if(0!=n){var u=document.getElementById("err_str");u&&(u.style.display="none")}if(6!=n)try{document.getElementById("credential2").disabled=!0,document.getElementById("credential2").style.display="none",document.getElementById("credential3").style.display="none"}catch(e){}switch(n){case 0:case 1:return void(document.location=d);case 2:document.getElementById("username").style.display="",document.getElementById("credential").style.display="",document.getElementById("username").disabled=!0,document.getElementById("credential").disabled=!0,document.getElementById("code").value="",document.getElementById("code").style.display="",document.getElementById("code").focus(),"ftm_push"!=tokeninfo&&"remote_token_auth"!=tokeninfo||!ftm_pushed_enabled||token_push_request_in_progress?local_token_handler(pol_id):try_ftm_push(pol_id,"ftm_push"==tokeninfo);break;case 3:document.getElementById("username").disabled=!0,document.getElementById("credential").disabled=!0,document.getElementById("token_msg").style.display="",document.getElementById("token_label").innerHTML="An email message containing a Token Code will be sent to &lt;"+decodeURIComponent(tokeninfo)+"&gt; in a moment.",document.getElementById("code").placeholder="Email Code",document.getElementById("code").value="",document.getElementById("code").style.display="",document.getElementById("code").focus(),local_token_handler(pol_id);break;case 4:document.getElementById("username").disabled=!0,document.getElementById("credential").disabled=!0,document.getElementById("token_msg").style.display="",document.getElementById("token_label").innerHTML="An SMS message containing a Token Code will be sent to &lt;"+decodeURIComponent(tokeninfo)+"&gt; in a moment.",document.getElementById("code").placeholder="SMS Code",document.getElementById("code").value="",document.getElementById("code").style.display="",document.getElementById("code").focus(),local_token_handler(pol_id);break;case 5:document.getElementById("code").disabled=!0,document.getElementById("driftmsg").style.display="",document.getElementById("code2").value="",document.getElementById("code2").style.display="",document.getElementById("code2").focus();break;case 6:document.getElementById("username").style.display="none",document.getElementById("credential").style.display="none",document.getElementById("code").style.display="none",document.getElementById("credential2").disabled=!1,document.getElementById("credential2").value="",document.getElementById("credential3").value="",document.getElementById("token_msg").style.display="",document.getElementById("token_label").innerHTML=i,"1"==pass_renew?(document.getElementById("credential2").placeholder="New Password",document.getElementById("credential3").placeholder="Confirm New Password",document.getElementById("credential3").style.display="",1==m&&(document.getElementById("skip_button").style.display="block")):(document.getElementById("credential2").placeholder="Answer",document.getElementById("credential3").style.display="none"),document.getElementById("credential2").style.display=""}o&&(document.getElementById("magic_id").disabled=!1,document.getElementById("reqid_id").disabled=!1,document.getElementById("grpid_id").disabled=!1,document.getElementById("magic_id").value=o,document.getElementById("reqid_id").value=famreqid+","+pol_id,document.getElementById("grpid_id").value=l+","+r+","+s)}}}function login_send_request(e,t){(my_xmlhttp=get_xmlhttp()).onreadystatechange=handle_buffer_statechange,my_xmlhttp.open("POST",e,!0),my_xmlhttp.setRequestHeader("Pragma","no-cache"),my_xmlhttp.setRequestHeader("Cache-Control","no-store, no-cache, must-revalidate"),my_xmlhttp.setRequestHeader("If-Modified-Since","Sat, 1 Jan 2000 00:00:00 GMT"),my_xmlhttp.send(t),document.getElementById("magic_id").value=""}function handle_buffer_statechange(e){4==my_xmlhttp.readyState&&handle_buffer_ready()}function try_login(){if(buf_request_in_progress&&!token_push_request_in_progress)throw"Avoid sending conflicting request\n";token_push_request_in_progress&&abort_current_request(),buf_request_in_progress=!0;var e=document.getElementById("username"),t=document.getElementById("realm_id"),n="ajax=1&username="+encodeURIComponent(e.value),d=document.getElementById("credential"),o=null;n+="&realm="+encodeURIComponent(t.value);var l=document.getElementById("magic_id");if("none"==document.getElementById("code").style.display){if(l&&""!=l.value)if("1"==pass_renew){d=document.getElementById("credential2");var r=document.getElementById("credential3");if(d.value!=r.value)return buf_request_in_progress=!1,void alert("The passwords do not match!")}else o=document.getElementById("credential2")}else n+="&code="+document.getElementById("code").value+"&code2="+document.getElementById("code2").value+"&polid="+pol_id+"&grp="+grp;l&&""!=l.value&&(n+="&magic="+l.value+"&reqid="+document.getElementById("reqid_id").value+"&grpid="+document.getElementById("grpid_id").value),peer&&(n+="&peer="+peer),n+="&credential="+encodeURIComponent(d.value),o&&(n+="&credential2="+encodeURIComponent(o.value));try{login_send_request("/remote/logincheck",n)}catch(e){buf_request_in_progress=!1,token_push_request_in_progress=!1,abort_current_request()}}function try_skip(){if(buf_request_in_progress&&!token_push_request_in_progress)throw"Avoid sending conflicting request\n";token_push_request_in_progress&&abort_current_request(),buf_request_in_progress=!0;var e=document.getElementById("username"),t=document.getElementById("realm_id"),n="ajax=1&username="+encodeURIComponent(e.value),d=document.getElementById("credential");n+="&magic="+document.getElementById("magic_id").value,n+="&realm="+encodeURIComponent(t.value),n+="&credential="+encodeURIComponent(d.value),n+="&reqid="+famreqid,n+="&grpid="+document.getElementById("grpid_id").value,n+="&skip=1",peer&&(n+="&peer="+peer);try{login_send_request("/remote/logincheck",n)}catch(e){token_push_request_in_progress=!1,abort_current_request()}}function try_ftm_push(e,t){if(buf_request_in_progress)throw"Avoid sending conflicting request\n";buf_request_in_progress=!0,token_push_request_in_progress=!0;var n=document.getElementById("username"),d=document.getElementById("realm_id"),o="ajax=1&username="+encodeURIComponent(n.value),l=document.getElementById("credential"),r=document.getElementById("magic_id");o+="&realm="+encodeURIComponent(d.value),o+="&credential="+encodeURIComponent(l.value),o+="&magic="+r.value,o+="&ftmpush="+ +t,void 0!==e&&(o+="&polid="+e),o+="&reqid="+famreqid,o+="&grp="+grp,peer&&(o+="&peer="+peer);try{login_send_request("/remote/logincheck",o)}catch(e){token_push_request_in_progress=!1,abort_current_request()}}function local_token_handler(e){if(buf_request_in_progress)throw"Avoid sending conflicting request\n";buf_request_in_progress=!0,token_push_request_in_progress=!0;var t=document.getElementById("username"),n="ajax=1&username="+encodeURIComponent(t.value);n+="&magic="+document.getElementById("magic_id").value,void 0!==e&&(n+="&polid="+e),n+="&reqid="+famreqid,n+="&grp="+grp,peer&&(n+="&peer="+peer);try{login_send_request("/remote/logincheck",n)}catch(e){token_push_request_in_progress=!1,abort_current_request()}}function login_get_cmd_kbd_event(e){return e||(evt=window.event,evt||null)}function login_crack_kbd_event(e){return e.which?e.which:e.keyCode?e.keyCode:e.charCode?e.charCode:0}function key_pressdown(e){try{var t=login_get_cmd_kbd_event(e);if(null==t)return;var n=login_crack_kbd_event(t);if(0==n)return;if(13==n)return document.getElementById("login_button").click(),!1}catch(e){}return!0}function abort_current_request(){my_xmlhttp.abort(),delete my_xmlhttp,my_xmlhttp=null}function launchFortiClient(){document.querySelector("#launch-forticlient-iframe").src="fabricagent://?hostname="+encodeURIComponent(window.location.hostname)+"&"+(window.location.port?"port="+encodeURIComponent(window.location.port):"")}function launchSamlLogin(){var e=document.getElementById("realm_id");url="/remote/saml/start?realm="+encodeURIComponent(e.value),window.location=e?url:"/remote/saml/start"}document.addEventListener("DOMContentLoaded",function(){-1!==navigator.platform.indexOf("Linux")&&(document.querySelector("#launch-forticlient-button").style.display="none");"Please Login"==document.title.trim()&&(document.title=fgt_lang.sslvpn_login_login);var e=document.getElementById("launch-forticlient-button");e&&"Launch FortiClient"==e.lastElementChild.innerHTML.trim()&&(e.innerHTML=fgt_lang["sslvpn_portal::Launch FortiClient"]);var t=document.getElementById("saml_login_id");if(t&&"0"!=t.value){var n=document.getElementById("saml-login-bn");n&&(n.innerHTML=fgt_lang["sslvpn-saml_login"],n.style.display="")}var d=document.getElementById("login_button");d&&"Login"==d.innerHTML.trim()&&(d.innerHTML=fgt_lang.sslvpn_login_login_b),document.getElementById("username").placeholder=fgt_lang.Username,document.getElementById("credential").placeholder=fgt_lang.Password;var o=document.getElementById("login-login");o&&"Please Login"==o.innerHTML.trim()&&(o.innerHTML=fgt_lang.sslvpn_login_login)});